"use strict";(()=>{var $e=Object.create;var se=Object.defineProperty;var Ye=Object.getOwnPropertyDescriptor;var fe=(s,t)=>(t=Symbol[s])?t:Symbol.for("Symbol."+s),L=s=>{throw TypeError(s)};var ge=(s,t,e)=>t in s?se(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var ue=(s,t)=>se(s,"name",{value:t,configurable:!0});var ye=s=>[,,,$e(s?.[fe("metadata")]??null)],ve=["class","method","getter","setter","accessor","field","value","get","set"],$=s=>s!==void 0&&typeof s!="function"?L("Function expected"):s,We=(s,t,e,n,r)=>({kind:ve[s],name:t,metadata:n,addInitializer:i=>e._?L("Already initialized"):r.push($(i||null))}),re=(s,t)=>ge(t,fe("metadata"),s[3]),be=(s,t,e,n)=>{for(var r=0,i=s[t>>1],c=i&&i.length;r<c;r++)t&1?i[r].call(e):n=i[r].call(e,n);return n},T=(s,t,e,n,r,i)=>{var c,a,l,p,E,d=t&7,H=!!(t&8),u=!!(t&16),A=d>3?s.length+1:d?H?1:2:0,D=ve[d+5],U=d>3&&(s[A-1]=[]),B=s[A]||(s[A]=[]),f=d&&(!u&&!H&&(r=r.prototype),d<5&&(d>3||!u)&&Ye(d<4?r:{get[e](){return o(this,i)},set[e](g){return k(this,i,g)}},e));d?u&&d<4&&ue(i,(d>2?"set ":d>1?"get ":"")+e):ue(r,e);for(var N=n.length-1;N>=0;N--)p=We(d,e,l={},s[3],B),d&&(p.static=H,p.private=u,E=p.access={has:u?g=>je(r,g):g=>e in g},d^3&&(E.get=u?g=>(d^1?o:O)(g,r,d^4?i:f.get):g=>g[e]),d>2&&(E.set=u?(g,K)=>k(g,r,K,d^4?i:f.set):(g,K)=>g[e]=K)),a=(0,n[N])(d?d<4?u?i:f[D]:d>4?void 0:{get:f.get,set:f.set}:r,p),l._=1,d^4||a===void 0?$(a)&&(d>4?U.unshift(a):d?u?i=a:f[D]=a:r=a):typeof a!="object"||a===null?L("Object expected"):($(c=a.get)&&(f.get=c),$(c=a.set)&&(f.set=c),$(c=a.init)&&U.unshift(c));return d||re(s,r),f&&se(r,e,f),u?d^4?i:f:r},oe=(s,t,e)=>ge(s,typeof t!="symbol"?t+"":t,e),ae=(s,t,e)=>t.has(s)||L("Cannot "+e),je=(s,t)=>Object(t)!==t?L('Cannot use the "in" operator on this value'):s.has(t),o=(s,t,e)=>(ae(s,t,"read from private field"),e?e.call(s):t.get(s)),w=(s,t,e)=>t.has(s)?L("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),k=(s,t,e,n)=>(ae(s,t,"write to private field"),n?n.call(s,e):t.set(s,e),e),O=(s,t,e)=>(ae(s,t,"access private method"),e);var ze=s=>btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");var Ee=s=>{if(s===void 0)throw new TypeError("encodeBase64: `undefined` cannot be encoded to valid JSON. Pass null instead.");let t=JSON.stringify(s),e=new TextEncoder().encode(t),n="";for(let r of e)n+=String.fromCharCode(r);return ze(n)};var z=class{callbacks=new Map;on(t,e){this.callbacks.has(t)||this.callbacks.set(t,new Set),this.callbacks.get(t).add(e)}emit(t,...e){let n=e[0];this.callbacks.get(t)?.forEach(r=>r(n))}off(t,e){e?this.callbacks.get(t)?.delete(e):this.callbacks.delete(t)}allOff(){this.callbacks.clear()}};async function Ce(s,t){let e=s.getReader(),n;for(;!(n=await e.read()).done;)t(n.value)}function ke(s){let t,e,n,r=!1;return function(c){t===void 0?(t=c,e=0,n=-1):t=qe(t,c);let a=t.length,l=0;for(;e<a;){r&&(t[e]===10&&(l=++e),r=!1);let p=-1;for(;e<a&&p===-1;++e)switch(t[e]){case 58:n===-1&&(n=e-l);break;case 13:r=!0;case 10:p=e;break}if(p===-1)break;s(t.subarray(l,p),n),l=e,n=-1}l===a?t=void 0:l!==0&&(t=t.subarray(l),e-=l)}}function Te(s,t,e){let n=we(),r=new TextDecoder;return function(c,a){if(c.length===0)e?.(n),n=we();else if(a>0){let l=r.decode(c.subarray(0,a)),p=a+(c[a+1]===32?2:1),E=r.decode(c.subarray(p));switch(l){case"data":n.data=n.data?n.data+`
`+E:E;break;case"event":n.event=E;break;case"id":s(n.id=E);break;case"retry":let d=parseInt(E,10);isNaN(d)||t(n.retry=d);break}}}}function qe(s,t){let e=new Uint8Array(s.length+t.length);return e.set(s),e.set(t,s.length),e}function we(){return{data:"",event:"",id:"",retry:void 0}}var Ve=function(s,t){var e={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&t.indexOf(n)<0&&(e[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(s);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(s,n[r])&&(e[n[r]]=s[n[r]]);return e},q="text/event-stream",Xe=1e3,_e="last-event-id";function ie(s,t){var{signal:e,headers:n,onopen:r,onmessage:i,onclose:c,onerror:a,openWhenHidden:l,fetch:p}=t,E=Ve(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((d,H)=>{let u=Object.assign({},n);u.accept||(u.accept=q);let A;function D(){A.abort(),document.hidden||K()}l||document.addEventListener("visibilitychange",D);let U=Xe,B=0;function f(){document.removeEventListener("visibilitychange",D),window.clearTimeout(B),A.abort()}e?.addEventListener("abort",()=>{f(),d()});let N=p??window.fetch,g=r??Je;async function K(){var ne;A=new AbortController;try{let j=await N(s,Object.assign(Object.assign({},E),{headers:u,signal:A.signal}));await g(j),await Ce(j.body,ke(Te(I=>{I?u[_e]=I:delete u[_e]},I=>{U=I},i))),c?.(),f(),d()}catch(j){if(!A.signal.aborted)try{let I=(ne=a?.(j))!==null&&ne!==void 0?ne:U;window.clearTimeout(B),B=window.setTimeout(K,I)}catch(I){f(),H(I)}}}K()})}function Je(s){let t=s.headers.get("content-type");if(!t?.startsWith(q))throw new Error(`Expected content-type to be ${q}, Actual: ${t}`)}var ce="__chatkit_error__",V=class s extends Error{status;statusText;constructor(t,e){super(t),this.name="HttpError",this.statusText=e.statusText,this.status=e.status}static fromPossibleFrameSafeError(t){if(t instanceof s)return t;if(t&&typeof t=="object"&&ce in t&&t[ce]==="HttpError"){let e=t,n=new s(e.message,{status:e.status,statusText:e.statusText});return n.stack=e.stack,n}return null}},P=class{[ce]="HttpError";message;stack;status;statusText;constructor(t,e){this.message=t,this.stack=new Error(t).stack,this.status=e.status,this.statusText=e.statusText}};var xe=(s,t=1e4,e=1e3)=>{let n=Math.min(t,e*2**s);return Math.floor(n*(.5+Math.random()*.5))};var X=class extends Error{constructor(t){super(),this.cause=t}},Se=async(s,t)=>{let e=0;await ie(s,{...t,onopen:async n=>{if(n.ok&&n.headers.get("content-type")?.startsWith("text/event-stream")){e=0;return}let r=new P(`Streaming failed: ${n.statusText}`,n);throw n.status>=400&&n.status<500?r:new X(r)},onerror:n=>{if(n instanceof X){if(e>=5)throw n.cause;return e+=1,xe(e)}throw n}})};var de="__chatkit_error__",_=class s extends Error{_name;constructor(t){super(t),this.name="IntegrationError",this._name=this.name}static fromPossibleFrameSafeError(t){if(t&&typeof t=="object"&&de in t&&t[de]==="IntegrationError"){let e=t,n=new s(e.message);return n.stack=e.stack,n}return null}},J=class{[de]="IntegrationError";message;stack;constructor(t){this.message=t,this.stack=new Error(t).stack}};var G=class{targetOrigin;target;commandHandlers;_fetch;constructor({handlers:t,target:e,targetOrigin:n,fetch:r=window.fetch}){this.commandHandlers=t,this.target=e,this.targetOrigin=n,this._fetch=((...i)=>r(...i))}emitter=new z;handlers=new Map;fetchEventSourceHandlers=new Map;abortControllers=new Map;sendMessage(t,e){let n={__oaiChatKit:!0,...t};this.target()?.postMessage(n,this.targetOrigin,e)}connect(){window.addEventListener("message",this.handleMessage)}disconnect(){window.removeEventListener("message",this.handleMessage)}fetch(t,e){return new Promise((n,r)=>{let i=crypto.randomUUID();this.handlers.set(i,{resolve:n,reject:r,stack:new Error().stack||""});let c;if(e.body instanceof FormData){c={};for(let[a,l]of e.body.entries())c[a]=l;e.body=void 0}e.signal&&(e.signal.addEventListener("abort",()=>{this.sendMessage({type:"abortSignal",nonce:i,reason:e.signal?.reason})}),e.signal=void 0),this.sendMessage({type:"fetch",nonce:i,params:e,formData:c,url:t})})}fetchEventSource(t,e){return new Promise((n,r)=>{let{onmessage:i,...c}=e,a=crypto.randomUUID();this.handlers.set(a,{resolve:n,reject:r,stack:new Error().stack||""}),this.fetchEventSourceHandlers.set(a,{onmessage:i}),e.signal&&(e.signal.addEventListener("abort",()=>{this.sendMessage({type:"abortSignal",nonce:a,reason:e.signal?.reason})}),e.signal=void 0),this.sendMessage({type:"fetchEventSource",nonce:a,params:c,url:t})})}commands=new Proxy({},{get:(t,e)=>(n,r)=>new Promise((i,c)=>{let a=crypto.randomUUID();this.handlers.set(a,{resolve:i,reject:c,stack:new Error().stack||""}),this.sendMessage({type:"command",nonce:a,command:`on${e.charAt(0).toUpperCase()}${e.slice(1)}`,data:n},r)})});emit(...[t,e,n]){this.sendMessage({type:"event",event:t,data:e},n)}on(...[t,e]){this.emitter.on(t,e)}destroy(){window.removeEventListener("message",this.handleMessage),this.emitter.allOff(),this.handlers.clear()}handleMessage=async t=>{if(!t.data||t.data.__oaiChatKit!==!0||t.origin!==this.targetOrigin||t.source!==this.target())return;let e=t.data;switch(e.type){case"event":{this.emitter.emit(e.event,e.data);break}case"fetch":{try{if(e.formData){let c=new FormData;for(let[a,l]of Object.entries(e.formData))c.append(a,l);e.params.body=c}let n=new AbortController;this.abortControllers.set(e.nonce,n),e.params.signal=n.signal;let r=await this._fetch(e.url,e.params);if(!r.ok){let c=await r.json().then(a=>a.message||r.statusText).catch(()=>r.statusText);throw new P(c,r)}let i=await r.json().catch(()=>({}));this.sendMessage({type:"response",response:i,nonce:e.nonce})}catch(n){this.sendMessage({type:"response",error:n,nonce:e.nonce})}break}case"fetchEventSource":{try{let n=new AbortController;this.abortControllers.set(e.nonce,n),await Se(e.url,{...e.params,signal:n.signal,fetch:this._fetch,onmessage:r=>{this.sendMessage({type:"fetchEventSourceMessage",message:r,nonce:e.nonce})}}),this.sendMessage({type:"response",response:void 0,nonce:e.nonce})}catch(n){this.sendMessage({type:"response",error:n,nonce:e.nonce})}break}case"command":{if(!this.canReceiveCommand(e.command)){this.sendMessage({type:"response",error:new J(`Command ${e.command} not supported`),nonce:e.nonce});return}try{let n=await this.commandHandlers[e.command]?.(e.data);this.sendMessage({type:"response",response:n,nonce:e.nonce})}catch(n){this.sendMessage({type:"response",error:n,nonce:e.nonce})}break}case"response":{let n=this.handlers.get(e.nonce);if(!n){console.error("No handler found for nonce",e.nonce);return}if(e.error){let r=_.fromPossibleFrameSafeError(e.error),i=V.fromPossibleFrameSafeError(e.error);r?(r.stack=n.stack,n.reject(r)):i?n.reject(i):n.reject(e.error)}else n.resolve(e.response);this.handlers.delete(e.nonce);break}case"fetchEventSourceMessage":{if(!this.fetchEventSourceHandlers.get(e.nonce)){console.error("No handler found for nonce",e.nonce);return}this.fetchEventSourceHandlers.get(e.nonce)?.onmessage?.(e.message);break}case"abortSignal":{let n=this.abortControllers.get(e.nonce);n&&(n.abort(e.reason),this.abortControllers.delete(e.nonce));break}default:break}}};var Q=class extends G{canReceiveCommand(t){return!0}};var Z=(s,t=new WeakSet)=>{if(typeof s=="function")return"[ChatKitMethod]";if(typeof s!="object"||s===null||t.has(s))return s;if(t.add(s),Array.isArray(s))return s.map(n=>Z(n,t));let e={};for(let[n,r]of Object.entries(s))typeof r!="function"?e[n]=Z(r,t):e[n]="[ChatKitMethod]";return e};var ee=["command.setOptions","command.sendUserMessage","command.setComposerValue","command.setThreadId","command.focusComposer","command.fetchUpdates","command.sendCustomAction","event.ready","event.error","event.log","event.response.start","event.response.end","event.thread.change","event.thread.load.start","event.thread.load.end","event.deeplink","backend.threads.get_by_id","backend.threads.list","backend.threads.update","backend.threads.delete","backend.threads.create","backend.threads.add_user_message","backend.threads.add_client_tool_output","backend.threads.retry_after_item","backend.threads.custom_action","backend.attachments.create","backend.attachments.get_preview","backend.attachments.delete","backend.items.list","backend.items.feedback","thread.item.user_message","thread.item.assistant_message","thread.item.client_tool_call","thread.item.widget","thread.item.task","thread.item.workflow","thread.item.end_of_turn"],Re=["command.shareThread","command.showHistory","command.hideHistory","command.showHistory","command.hideHistory","event.thread.restore","event.message.share","event.image.download","event.history.open","event.history.close","event.debug.response.end","event.debug.response.output_added","backend.threads.share","backend.threads.create_from_shared","backend.tools.list","backend.attachments.process","thread.item.image_generation"],Qe={chatkit:{allow:ee,deny:Re},"chatgpt-shell":{allow:[...ee,"command.shareThread","command.showHistory","command.hideHistory","event.thread.restore","event.message.share","event.image.download","event.history.open","event.history.close","event.debug.response.end","event.debug.response.output_added","backend.threads.share","backend.threads.create_from_shared","backend.tools.list","backend.attachments.process","thread.item.image_generation"],deny:["event.log","backend.threads.add_client_tool_output"]},"chatgpt-shell-anonymous":{allow:[...ee,"event.thread.restore","event.history.open","event.history.close","event.message.share","event.debug.response.end","event.debug.response.output_added","backend.threads.create_from_shared","backend.tools.list","backend.attachments.process","thread.item.image_generation"],deny:["event.log","backend.threads.add_client_tool_output","backend.threads.list"]}},he=s=>{let t=Qe[s],e=new Set(t.allow);for(let a of t.deny??[])e.delete(a);let n=new Set,r=new Set,i=new Set,c=new Set;for(let a of e){if(a.startsWith("command.")){n.add(a.slice(8));continue}if(a.startsWith("event.")){r.add(a.slice(6));continue}if(a.startsWith("backend.")){i.add(a.slice(8));continue}a.startsWith("thread.item.")&&c.add(a.slice(12))}return{commands:n,events:r,backend:i,threadItems:c}},Ct=[...ee,...Re];var Ae="https://cdn.platform.openai.com/deployments/chatkit/index-x2qMbITb68.html";function Oe(s){return Z(s)}function M(s,t){let e=String(t.name);return function(...n){if(!this.capabilities.commands.has(e))throw new _(`ChatKit command "${String(e)}" is not available for the "${this.profile}" profile.`);return s.apply(this,n)}}var Me,Ie,Ke,Le,Pe,Fe,He,De,Ue,Be,h,x,S,R,Y,v,m,b,te,le,W,F,me,C,y=class extends(Be=HTMLElement,Ue=[M],De=[M],He=[M],Fe=[M],Pe=[M],Le=[M],Ke=[M],Ie=[M],Me=[M],Be){constructor({profile:e}){super();be(C,5,this);w(this,b);oe(this,"profile");oe(this,"capabilities");w(this,h);w(this,x);w(this,S);w(this,R,this.attachShadow({mode:"open"}));w(this,Y);w(this,v,new Promise(e=>{k(this,Y,e)}));w(this,m,new Q({fetch:((...e)=>{let n=o(this,h)?.api&&"fetch"in o(this,h).api&&o(this,h).api.fetch;return n?n(...e):fetch(...e)}),target:()=>o(this,x)?.contentWindow??null,targetOrigin:new URL(Ae).origin,handlers:{onFileInputClick:({inputAttributes:e})=>new Promise(n=>{let r=document.createElement("input");for(let[c,a]of Object.entries(e))r.setAttribute(c,String(a));let i=()=>{n(Array.from(r.files||[])),o(this,R).contains(r)&&o(this,R).removeChild(r)};r.addEventListener("cancel",i),r.addEventListener("change",i),o(this,R).appendChild(r),r.click()}),onClientToolCall:async({name:e,params:n})=>{let r=o(this,h)?.onClientTool;return r||O(this,b,te).call(this,new _("No handler for client tool calls. You'll need to add onClientTool to your ChatKit options.")),r({name:e,params:n})},onWidgetAction:async({action:e,widgetItem:n})=>{let r=o(this,h)?.widgets?.onAction;return r||O(this,b,te).call(this,new _("No handler for widget actions. You'll need to add widgets.onAction to your ChatKit options.")),r(e,n)},onEntitySearch:async({query:e})=>o(this,h)?.entities?.onTagSearch?.(e)??[],onEntityClick:async({entity:e})=>o(this,h)?.entities?.onClick?.(e),onEntityPreview:async({entity:e})=>o(this,h)?.entities?.onRequestPreview?.(e)??{preview:null},onGetClientSecret:async e=>((!o(this,h)||!("getClientSecret"in o(this,h).api)||!o(this,h).api.getClientSecret)&&O(this,b,te).call(this,new _("Could not refresh the session because ChatKitOptions.api.getClientSecret is not configured.")),o(this,h).api.getClientSecret(e??null))}}));w(this,W,()=>{var e;this.dataset.loaded="true",this.dispatchEvent(new CustomEvent("chatkit.ready",{bubbles:!0,composed:!0})),(e=o(this,Y))==null||e.call(this)});w(this,F,!1);this.profile=e,this.capabilities=he(e)}setProfile(e){this.profile=e,this.capabilities=he(e)}connectedCallback(){let e=document.createElement("style");e.textContent=`
      :host {
        display: block;
        position: relative;
        height: 100%;
        width: 100%;
      }
      .ck-iframe {
        border: none;
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        color-scheme: light only;
      }
      .ck-wrapper {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        opacity: 0;
      }
      :host([data-color-scheme="dark"]) .ck-iframe {
        color-scheme: dark only;
      }
      :host([data-loaded="true"]) .ck-wrapper {
        opacity: 1;
      }
    `;let n=document.createElement("iframe");n.className="ck-iframe",n.name="chatkit",n.role="presentation",n.tabIndex=0,n.setAttribute("allowtransparency","true"),n.setAttribute("frameborder","0"),n.setAttribute("scrolling","no"),n.setAttribute("allow","clipboard-read; clipboard-write"),k(this,x,n);let r=document.createElement("div");r.className="ck-wrapper",r.appendChild(n),k(this,S,r),o(this,R).append(e),o(this,m).on("left_header_icon_click",()=>{o(this,h)?.header?.leftAction?.onClick()}),o(this,m).on("right_header_icon_click",()=>{o(this,h)?.header?.rightAction?.onClick()}),o(this,m).on("public_event",([i,c])=>{if(this.capabilities.events.has(i)){if(i==="error"&&"error"in c){let a=_.fromPossibleFrameSafeError(c.error)??c.error;this.dispatchEvent(new CustomEvent("chatkit.error",{detail:{error:a}}));return}this.dispatchEvent(new CustomEvent(`chatkit.${i}`,{detail:c}))}}),o(this,m).on("unmount",()=>{o(this,S)&&o(this,R).contains(o(this,S))&&(o(this,R).removeChild(o(this,S)),k(this,S,void 0),k(this,x,void 0))}),n.addEventListener("load",o(this,W),{once:!0}),O(this,b,me).call(this)}disconnectedCallback(){o(this,x)?.removeEventListener("load",o(this,W)),o(this,m).disconnect()}applySanitizedOptions(e){k(this,h,e),o(this,F)?(O(this,b,le).call(this,o(this,h)),o(this,v).then(()=>{o(this,m).commands.setOptions(Oe(e))})):O(this,b,me).call(this)}setOptions(e){let n=this.sanitizeOptions(e);this.applySanitizedOptions(n)}async focusComposer(){await o(this,v),o(this,x)?.focus(),await o(this,m)?.commands.focusComposer()}async fetchUpdates(){await o(this,v),await o(this,m)?.commands.fetchUpdates()}async sendUserMessage(e){await o(this,v),await o(this,m)?.commands.sendUserMessage(e)}async setComposerValue(e){await o(this,v),await o(this,m)?.commands.setComposerValue(e)}async setThreadId(e){await o(this,v),await o(this,m)?.commands.setThreadId({threadId:e})}async shareThread(){return await o(this,v),o(this,m)?.commands.shareThread()}async sendCustomAction(e,n){return await o(this,v),o(this,m)?.commands.sendCustomAction({action:e,itemId:n})}async showHistory(){return await o(this,v),o(this,m)?.commands.showHistory()}async hideHistory(){return await o(this,v),o(this,m)?.commands.hideHistory()}};C=ye(Be),h=new WeakMap,x=new WeakMap,S=new WeakMap,R=new WeakMap,Y=new WeakMap,v=new WeakMap,m=new WeakMap,b=new WeakSet,te=function(e){throw this.dispatchEvent(new CustomEvent("chatkit.error",{detail:{error:e}})),e},le=function(e){this.dataset.colorScheme=typeof e.theme=="string"?e.theme:e.theme?.colorScheme??"light"},W=new WeakMap,F=new WeakMap,me=function(){if(o(this,F)||!o(this,x)||!o(this,h))return;k(this,F,!0),O(this,b,le).call(this,o(this,h));let e=new URL(Ae);e.hash=Ee({options:Oe(o(this,h)),referrer:window.location.origin,profile:this.profile}),o(this,m).connect(),o(this,x).src=e.toString(),o(this,S)&&o(this,R).append(o(this,S))},T(C,1,"focusComposer",Ue,y),T(C,1,"fetchUpdates",De,y),T(C,1,"sendUserMessage",He,y),T(C,1,"setComposerValue",Fe,y),T(C,1,"setThreadId",Pe,y),T(C,1,"shareThread",Le,y),T(C,1,"sendCustomAction",Ke,y),T(C,1,"showHistory",Ie,y),T(C,1,"hideHistory",Me,y),re(C,y);var pe=class extends y{constructor(){super({profile:"chatkit"})}sanitizeOptions(t){return delete t.threadItemActions?.share,t}};function Ne(s="openai-chatkit"){"customElements"in globalThis&&(customElements.get(s)||customElements.define(s,pe))}Ne();})();
//# sourceMappingURL=chatkit.js.map
