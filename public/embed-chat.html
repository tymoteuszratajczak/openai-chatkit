<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.platform.openai.com/deployments/chatkit/chatkit.js" async></script>
  <style>
    html,body,#wrap{height:100%} body{margin:0;background:#0b1220;color:#e5e7eb;font-family:system-ui,Segoe UI,Roboto}
    #wrap{display:flex;align-items:center;justify-content:center}
    #my-chat{width:100%;max-width:420px;height:640px}
    #debug{position:fixed;left:8px;right:8px;bottom:8px;font-size:12px;opacity:.85}
    #debug pre{white-space:pre-wrap;background:#111827;color:#e5e7eb;padding:8px;border-radius:8px}
  </style>
</head>
<body>
  <div id="wrap"><div id="my-chat"></div></div>
  <div id="debug" aria-live="polite"></div>

  <script>
    const SESSION_URL = "https://powtor-y778f.kinsta.app/chatkit/session";
    const $d = document.getElementById("debug");
    const log = m => $d.innerHTML = `<pre>${(new Date).toLocaleTimeString()} ${m}</pre>` + $d.innerHTML;

    async function fetchClientSecret(){
      const r = await fetch(SESSION_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json","Cache-Control":"no-store"},
        body:"{}"
      });
      const t = await r.text(); let j; try{j=JSON.parse(t)}catch{}
      log(`POST /chatkit/session → ${r.status}\n${t.slice(0,200)}${t.length>200?"…":""}`);
      if(!r.ok) throw new Error(`Session ${r.status}: ${t}`);
      if(!j?.client_secret) throw new Error("Brak client_secret");
      return j.client_secret;
    }

    async function mount(){
      if(!customElements.get("openai-chatkit")){
        try{ await customElements.whenDefined("openai-chatkit"); }catch{}
      }
      const chat=document.createElement("openai-chatkit");
      chat.style.cssText="display:block;width:100%;height:100%";
      chat.setOptions({
        api:{
          async getClientSecret(){
            try{ return await fetchClientSecret(); }
            catch(e){ log("getClientSecret: "+e.message); throw e; }
          }
        },
        theme:{ colorPrimary:"#111827", radius:16 }
      });
      document.getElementById("my-chat").innerHTML="";
      document.getElementById("my-chat").appendChild(chat);
      log("ChatKit mounted");
    }

    if(document.readyState==="complete") mount();
    else addEventListener("load",mount);
  </script>
</body>
</html>
